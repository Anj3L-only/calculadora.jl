<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema JL Equipamentos</title>
    <link rel="icon" href="img_jl_logo.jpg">
    <link rel="stylesheet" href="style.css?v=6">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="logo-print">
        <img src="img_jl_logo.jpg" alt="JL Equipamentos">
    </div>

    <header class="app-bar">
        <div class="header-info">
            <img src="img_jl_logo.jpg" alt="Logo" class="logo-header">
            <div>
                <h1>JL EQUIPAMENTOS</h1>
                <p>João Pessoa - PB </p>
            </div>
        </div>
    </header>

    <div class="layout-principal">
        <div class="painel-ferramentas">
            <div class="card config-card">
                <div class="card-header"><span class="material-icons">person</span> Cliente & Entrega</div>
                <input type="text" id="nomeCliente" placeholder="Nome do Cliente" oninput="salvarProgresso()">
                
                <div class="input-group-mapa">
                    <input type="text" id="enderecoEntrega" placeholder="Endereço de Entrega" oninput="salvarProgresso()">
                    <button onclick="abrirMapa()" class="btn-mapa google" title="Abrir no Google Maps">
                        <span class="material-icons">map</span>
                    </button>
                    <button onclick="abrirWaze()" class="btn-mapa waze" title="Abrir no Waze">
                        <span class="material-icons">directions_car</span>
                    </button>
                </div>

                <div class="row">
                    <div class="col">
                        <label>Material:</label>
                        <select id="tipoMaterial" onchange="salvarProgresso()">
                            <option value="304">Inox 304 (8.00 g/cc)</option>
                            <option value="430">Inox 430 (7.74 g/cc)</option>
                            <option value="galv">Aço Carb. (7.87 g/cc)</option>
                        </select>
                    </div>
                    <div class="col">
                        <label>Preço Aço (R$/Kg):</label>
                        <input type="number" id="precoKg" placeholder="0.00" oninput="salvarProgresso()">
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header"><span class="material-icons">crop_landscape</span> Chapas</div>
                <div class="row">
                    <div class="col"><input type="number" id="comprimento" placeholder="Comp. (m)"></div>
                    <div class="col"><input type="number" id="largura" placeholder="Larg. (m)"></div>
                </div>
                <select id="espessura">
                    <option value="0.5">0.5 mm</option>
                    <option value="0.8">0.8 mm</option>
                    <option value="1.0" selected>1.0 mm</option>
                    <option value="1.5">1.5 mm</option>
                    <option value="2.0">2.0 mm</option>
                </select>
                <button onclick="adicionarChapa()" class="btn-add">Adicionar Chapa</button>
            </div>

            <div class="card">
                <div class="card-header"><span class="material-icons">crop_square</span> Tubos</div>
                <select id="formatoTubo" onchange="mudarLabelTubo()">
                    <option value="quadrado">Quadrado</option>
                    <option value="retangular">Retangular</option>
                    <option value="redondo">Redondo</option>
                </select>
                <div class="row">
                    <div class="col"><input type="number" id="medidaTubo" placeholder="Lado A/Diâm (mm)"></div>
                    <div class="col" id="boxMedida2" style="display:none;"><input type="number" id="medidaTubo2" placeholder="Lado B (mm)"></div>
                </div>
                <div class="row">
                    <div class="col"><input type="number" id="espessuraTubo" placeholder="Esp. (mm)"></div>
                    <div class="col"><input type="number" id="comprimentoTubo" placeholder="Comp. (m)"></div>
                </div>
                <button onclick="adicionarTubo()" class="btn-add dark">Adicionar Tubo</button>
            </div>

            <div class="card destaque-laranja">
                <div class="card-header"><span class="material-icons">shopping_cart</span> Outros Itens</div>
                <input type="text" id="nomeAcessorio" placeholder="Nome Acessório">
                <div class="row">
                    <div class="col"><input type="number" id="qtdAcessorio" placeholder="Qtd"></div>
                    <div class="col"><input type="number" id="precoAcessorio" placeholder="R$ Unit."></div>
                </div>
                <button onclick="adicionarAcessorio()" class="btn-add orange">Add Acessório</button>
                <hr>
                <label>Soldagem (Metros)</label>
                <div class="row">
                    <div class="col"><input type="number" id="metrosSolda" placeholder="Total Metros"></div>
                    <div class="col"><input type="number" id="custoMetroSolda" value="5.00"></div>
                </div>
                <button onclick="adicionarSolda()" class="btn-add" style="background:#7f8c8d;">Add Solda</button>
            </div>
        </div>

        <div class="painel-resumo">
            <div class="card recibo">
                <h3>Resumo do Orçamento</h3>
                <div class="tabela-container">
                    <table>
                        <thead><tr><th>Item</th><th style="text-align:right">Custo</th><th width="30"></th></tr></thead>
                        <tbody id="listaItens"></tbody>
                    </table>
                </div>
                <div class="total-parcial">Subtotal Material: <strong id="totalMaterial">R$ 0,00</strong></div>
                <button onclick="limparOrcamento()" class="btn-reset">LIMPAR TUDO</button>
            </div>

            <div class="card financeiro">
                <h3>Fechamento Comercial</h3>
                <div class="row">
                    <div class="col"><label>Extras (Luz/Disco):</label><input type="number" id="custoExtras" oninput="calcularTotalFinal()"></div>
                    <div class="col"><label>Mão de Obra:</label><input type="number" id="custoMaoObra" oninput="calcularTotalFinal()"></div>
                </div>
                
                <label>Margem de Lucro: <span id="labelMargem">30%</span></label>
                <input type="range" id="margemLucroRange" min="0" max="100" value="30" oninput="atualizarMargem()">

                <div class="frete-box">
                    <label>Logística / Entrega</label>
                    <select id="tipoFrete" onchange="alternarTipoFrete()">
                        <option value="proprio">Veículo Próprio</option>
                        <option value="terceiro">Terceirizado</option>
                    </select>
                    <div id="boxFreteProprio" style="margin-top:10px;">
                        <div class="row">
                            <div class="col"><label>Km Total</label><input type="number" id="distanciaKm" oninput="calcularFrete()"></div>
                            <div class="col"><label>Km/L</label><input type="number" id="consumoVeiculo" value="10" oninput="calcularFrete()"></div>
                            <div class="col"><label>R$/Litro</label><input type="number" id="precoCombustivel" value="6.00" oninput="calcularFrete()"></div>
                        </div>
                    </div>
                    <div id="boxFreteTerceiro" style="display:none; margin-top:10px;">
                        <input type="number" id="valorFreteTerceiro" placeholder="Valor Carreto" oninput="calcularFrete()">
                    </div>
                    <div class="row" style="margin-top:5px; border-top:1px dashed #bdddf7; padding-top:5px;">
                        <label>Custo Frete:</label>
                        <input type="number" id="valorFrete" readonly style="background:#eef7ff; font-weight:bold;">
                    </div>
                </div>

                <div class="col"><label>Desconto (R$):</label><input type="number" id="descontoVenda" oninput="calcularTotalFinal()"></div>
                
                <div class="row">
                    <div class="col"><label>Pagamento:</label><input type="text" id="formaPagamento" placeholder="Ex: Pix" oninput="salvarProgresso()"></div>
                    <div class="col"><label>Previsão:</label><input type="text" id="prazoEntrega" placeholder="Ex: 30 dias" oninput="salvarProgresso()"></div>
                </div>

                <div class="box-preco-final">
                    <div class="custo-detalhe">Custo Prod.: <span id="custoProducao">R$ 0,00</span></div>
                    <small>TOTAL FINAL</small>
                    <h1 id="precoVendaFinal">R$ 0,00</h1>
                    <small id="lucroLiquido">Lucro Líquido: R$ 0,00</small>
                </div>

                <div class="box-grafico">
                    <canvas id="graficoFinanceiro"></canvas>
                </div>

                <div class="acoes-exportacao">
                    <p class="titulo-export">Para o Cliente (Limpo):</p>
                    <div class="grid-botoes">
                        <button onclick="enviarWhatsApp()" class="btn-zap">WhatsApp</button>
                        <button onclick="imprimirCliente()" class="btn-print">PDF Cliente</button>
                    </div>
                    <p class="titulo-export" style="margin-top:15px;">Interno (Completo):</p>
                    <div class="grid-botoes">
                        <button onclick="enviarWhatsAppInterno()" class="btn-zap" style="background-color: #128C7E;">Relatório</button>
                        <button onclick="imprimirInterno()" class="btn-print dark">PDF Geral</button>
                        <button onclick="gerarExcelInterno()" class="btn-excel">Excel</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="footer-termos">
            <h4>Termos e Condições</h4>
            <p>1. Validade: 5 dias. 2. Garantia de 90 dias na fabricação. 3. Frete calculado por consumo de combustível.</p>
        </div>
    </div>
    <script src="script.js?v=6"></script>
</body>
</html>