<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JL Sistemas - ERP Industrial v17</title>
    <link rel="icon" href="assets/img/img_jl_logo.jpg">
    <link rel="stylesheet" href="style.css?v=17">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="logo-print"><img src="assets/img/img_jl_logo.jpg" alt="JL Equipamentos"></div>

    <header class="app-bar">
        <div class="header-info">
            <img src="assets/img/img_jl_logo.jpg" alt="Logo" class="logo-header">
            <div>
                <h1>JL EQUIPAMENTOS</h1>
                <p>João Pessoa - PB </p>
            </div>
        </div>
    </header>

    <div class="layout-principal">
        
        <div class="painel-ferramentas">
            <div class="card historico-card">
                <div class="card-header"><span class="material-icons">history</span> Memória de Cálculo</div>
                <div id="listaHistorico" class="lista-historico"><small style="padding:10px; display:block; color:#888">Nenhum salvo.</small></div>
                <button onclick="salvarNoHistorico()" class="btn-add dark" style="margin-top:10px; font-size:12px;">SALVAR ORÇAMENTO</button>
            </div>

            <div class="card config-card">
                <div class="card-header"><span class="material-icons">person</span> Cliente & Local</div>
                <input type="text" id="nomeCliente" placeholder="Nome do Cliente" oninput="salvarProgresso()">
                <div class="input-group-mapa">
                    <input type="text" id="enderecoEntrega" placeholder="Endereço de Entrega" oninput="salvarProgresso()">
                    <button onclick="abrirMapa()" class="btn-mapa google" title="Maps"><span class="material-icons">map</span></button>
                    <button onclick="abrirWaze()" class="btn-mapa waze" title="Waze"><span class="material-icons">directions_car</span></button>
                </div>
                <textarea id="obsOrcamento" placeholder="Obs: Detalhes técnicos, acabamento..." rows="2" style="width:100%; margin-top:5px; padding:8px; border:1px solid #ccc; border-radius:6px;"></textarea>
            </div>

            <div class="card">
                <div class="card-header"><span class="material-icons">inventory_2</span> Material Base</div>
                <input type="text" id="buscaMaterial" placeholder="Buscar (Ex: 304, Nylon)..." oninput="filtrarMateriais()">
                <div class="row">
                    <div class="col">
                        <select id="tipoMaterial" onchange="salvarProgresso()">
                            <optgroup label="Aços Inoxidáveis">
                                <option value="304">Inox 304 (8.00 g/cc)</option>
                                <option value="430">Inox 430 (7.74 g/cc)</option>
                                <option value="316">Inox 316 (7.98 g/cc)</option>
                            </optgroup>
                            <optgroup label="Aços Carbono">
                                <option value="galv">Galvanizado (7.87 g/cc)</option>
                                <option value="1020">SAE 1020 (7.85 g/cc)</option>
                            </optgroup>
                            <optgroup label="Metais Não Ferrosos">
                                <option value="alu">Alumínio (2.70 g/cc)</option>
                                <option value="lat">Latão (8.50 g/cc)</option>
                                <option value="cob">Cobre (8.96 g/cc)</option>
                            </optgroup>
                            <optgroup label="Plásticos">
                                <option value="nyl">Nylon (1.14 g/cc)</option>
                                <option value="uhmw">UHMW (0.94 g/cc)</option>
                            </optgroup>
                        </select>
                    </div>
                    <div class="col"><input type="number" id="precoKg" placeholder="R$/Kg (Ex: 45.90)" oninput="salvarProgresso()"></div>
                </div>
            </div>

            <div class="card">
                <div class="card-header"><span class="material-icons">crop_landscape</span> Chapas (mm)</div>
                <div class="row">
                    <div class="col"><label>Comp. (mm)</label><input type="number" id="comprimento" placeholder="Ex: 2000"></div>
                    <div class="col"><label>Larg. (mm)</label><input type="number" id="largura" placeholder="Ex: 1000"></div>
                </div>
                <div class="row" style="margin-top:5px;">
                    <div class="col">
                        <label>Espessura (mm)</label>
                        <select id="espessura">
                            <option value="0.5">0.5 mm</option><option value="0.8">0.8 mm</option>
                            <option value="1.0" selected>1.0 mm</option><option value="1.2">1.2 mm</option>
                            <option value="1.5">1.5 mm</option><option value="2.0">2.0 mm</option>
                            <option value="3.0">3.0 mm</option><option value="4.75">3/16" (4.75)</option>
                        </select>
                    </div>
                    <div class="col"><label>Qtd Peças</label><input type="number" id="qtdChapa" value="1"></div>
                </div>
                <button onclick="adicionarChapa()" class="btn-add">Adicionar Chapa</button>
            </div>

            <div class="card">
                <div class="card-header"><span class="material-icons">view_in_ar</span> Tubos / Perfis</div>
                <div class="row">
                    <div class="col">
                        <select id="formatoTubo" onchange="mudarLabelTubo()">
                            <option value="quadrado">Quadrado</option>
                            <option value="retangular">Retangular</option>
                            <option value="redondo">Redondo</option>
                            <option value="macico">Tarugo</option>
                        </select>
                    </div>
                    <div class="col"><input type="number" id="medidaTubo" placeholder="Bitola A (Ex: 40.0)"></div>
                </div>
                <div class="row" id="boxMedida2" style="display:none; margin-top:5px;">
                    <div class="col"><input type="number" id="medidaTubo2" placeholder="Bitola B (Ex: 20.0)"></div>
                </div>
                <div class="row" style="margin-top:5px;">
                    <div class="col">
                        <label style="color:#d35400;">Parede (mm)</label>
                        <input type="text" id="espessuraTubo" placeholder="Ex: 1.2 ou 1.5">
                    </div>
                    <div class="col">
                        <label>Total Metros</label>
                        <input type="number" id="comprimentoTubo" placeholder="Ex: 6.0">
                    </div>
                </div>
                <button onclick="adicionarTubo()" class="btn-add dark">Adicionar Tubo</button>
            </div>

            <div class="card destaque-laranja">
                <div class="card-header"><span class="material-icons">handyman</span> Serviços & Solda</div>
                
                <div class="row">
                    <div class="col">
                        <label>Descrição do Serviço:</label>
                        <input type="text" id="descServico" placeholder="Ex: Solda TIG, Polimento...">
                    </div>
                </div>
                
                <div class="row" style="margin-top:5px;">
                    <div class="col">
                        <label>Unidade:</label>
                        <select id="unidadeServico">
                            <option value="m">Metro Linear (m)</option>
                            <option value="m2">Metro Quadrado (m²)</option>
                            <option value="un">Unidade / Peça</option>
                        </select>
                    </div>
                    <div class="col"><label>Qtd:</label><input type="number" id="qtdServico" placeholder="Ex: 2.5"></div>
                    <div class="col"><label>R$ Unit.</label><input type="number" id="valorServico" placeholder="Valor"></div>
                </div>
                
                <button onclick="adicionarServico()" class="btn-add orange">Lançar Serviço</button>
                
                <hr>
                
                <div class="row">
                    <div class="col"><input type="text" id="nomeAcessorio" placeholder="Item Extra"></div>
                    <div class="col"><input type="number" id="valorAcessorio" placeholder="R$ Total"></div>
                </div>
                <button onclick="adicionarAcessorio()" class="btn-add" style="background:#7f8c8d;">Add Item</button>
            </div>
        </div>

        <div class="painel-resumo">
            <div class="card recibo">
                <h3>Resumo da Proposta</h3>
                <div class="tabela-container">
                    <table>
                        <thead><tr><th>Desc.</th><th align="right">R$</th><th width="30"></th></tr></thead>
                        <tbody id="listaItens"></tbody>
                    </table>
                </div>
                <div class="info-peso">Peso Estimado: <strong id="pesoTotalDisplay">0.00 kg</strong></div>
                <div class="total-parcial">Custo Parcial: <strong id="totalMaterial">R$ 0,00</strong></div>
                <button onclick="limparOrcamento()" class="btn-reset">NOVO / LIMPAR</button>
            </div>

            <div class="card financeiro">
                <h3>Fechamento Comercial</h3>
                <div class="row">
                    <div class="col"><label>Extras:</label><input type="number" id="custoExtras" oninput="calcularTotalFinal()"></div>
                    <div class="col"><label>Mão de Obra:</label><input type="number" id="custoMaoObra" oninput="calcularTotalFinal()"></div>
                </div>
                
                <label>Margem (%):</label>
                <input type="number" id="margemLucro" value="30" oninput="calcularTotalFinal()">

                <div class="frete-box">
                    <label>Logística / Entrega</label>
                    <select id="tipoFrete" onchange="alternarTipoFrete()">
                        <option value="proprio">Veículo Próprio</option>
                        <option value="terceiro">Terceirizado</option>
                    </select>
                    <div id="boxFreteProprio" style="margin-top:10px;">
                        <div class="row">
                            <div class="col"><label>Km Total</label><input type="number" id="distanciaKm" oninput="calcularFrete()"></div>
                            <div class="col"><label>Km/L</label><input type="number" id="consumoVeiculo" value="10" oninput="calcularFrete()"></div>
                            <div class="col"><label>R$/L</label><input type="number" id="precoCombustivel" value="6.00" oninput="calcularFrete()"></div>
                        </div>
                    </div>
                    <div id="boxFreteTerceiro" style="display:none; margin-top:10px;">
                        <input type="number" id="valorFreteTerceiro" placeholder="R$ Frete" oninput="calcularFrete()">
                    </div>
                    <div class="row" style="margin-top:5px; border-top:1px dashed #bdddf7; padding-top:5px;">
                        <label>Custo Frete:</label>
                        <input type="number" id="valorFrete" readonly style="background:#eef7ff; font-weight:bold;">
                    </div>
                </div>

                <div class="col" style="margin-top:10px;"><label>Desconto (R$):</label><input type="number" id="descontoVenda" oninput="calcularTotalFinal()"></div>
                
                <div class="row">
                    <div class="col"><label>Pagamento:</label><input type="text" id="formaPagamento" placeholder="Ex: Pix 50/50" oninput="salvarProgresso()"></div>
                    <div class="col"><label>Entrega:</label><input type="text" id="prazoEntrega" placeholder="Ex: 15 dias" oninput="salvarProgresso()"></div>
                </div>

                <div class="box-preco-final">
                    <div style="font-size:11px; opacity:0.8">Custo Prod.: <span id="custoProducao">R$ 0,00</span></div>
                    <h1 id="precoVendaFinal" style="margin:5px 0;">R$ 0,00</h1>
                    <small id="lucroLiquido">Lucro Líq: R$ 0,00</small>
                </div>

                <div class="box-grafico"><canvas id="graficoFinanceiro"></canvas></div>

                <div class="grid-botoes">
                    <button onclick="enviarWhatsApp()" class="btn-zap">WhatsApp</button>
                    <button onclick="imprimirCliente()" class="btn-print">PDF Cliente</button>
                    <button onclick="gerarExcelInterno()" class="btn-excel">Excel</button>
                </div>
            </div>
        </div>
    </div>
    <script src="script.js?v=17"></script>
</body>
</html>